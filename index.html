<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>SeeBee â€“ Meliponicultura</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="theme-color" content="#020617" />
  <link rel="manifest" href="manifest.webmanifest" />
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  
  <link rel="stylesheet" href="./css/main.css" />
  <style>
    /* Estilo Extra para os Submenus (Segmented Control) */
    .segmented-control {
      display: flex; background: #1e293b; padding: 4px; border-radius: 8px; margin-bottom: 16px;
    }
    .segment-btn {
      flex: 1; padding: 8px; border: none; background: transparent; color: #94a3b8;
      font-size: 0.85rem; border-radius: 6px; cursor: pointer; transition: all 0.2s;
    }
    .segment-btn.active { background: #0f172a; color: #fff; font-weight: 600; shadow: 0 1px 3px rgba(0,0,0,0.2); }
    
    .status-alert { color: #facc15; font-size: 0.8rem; margin-top: 4px; display: block; }
    .status-ok { color: #4ade80; font-size: 0.8rem; }
  </style>
</head>
<body>

  <div id="auth-screen">
    <div class="brand-hero"><div class="brand-logo">ğŸ</div><div class="brand-name">SeeBee</div></div>
    <div id="auth-card">
      <h2>Entrar</h2>
      <div class="auth-field"><label>E-mail</label><input id="email" type="email" /></div>
      <div class="auth-field"><label>Senha</label><input id="password" type="password" /></div>
      <div class="auth-buttons">
        <button id="btnLogin" class="btn-primary">Entrar</button>
        <button id="btnSignup" class="btn-outline">Criar Conta</button>
      </div>
      <button id="btnGoogle" class="btn-google">Entrar com Google</button>
      <div id="authMsg" class="auth-msg"></div>
    </div>
  </div>

  <div id="app-screen" class="hidden">
    <header class="app-header">
      <div class="brand-mini">ğŸ SeeBee</div>
      <div class="status-pill"><span id="onlineDot" class="status-dot"></span><span id="onlineText">Online</span></div>
    </header>

    <section id="view-meliponaries" class="view-section active">
      <div class="section-title"><h2>MeliponÃ¡rios</h2><button class="btn-xs">Novo</button></div>
      <div id="colonies-list" class="list-vertical">Carregando...</div>
    </section>

    <section id="view-traps" class="view-section hidden">
      <div class="segmented-control">
        <button class="segment-btn active" data-sub="sub-deposit">Depositar</button>
        <button class="segment-btn" data-sub="sub-trails">Minhas Trilhas</button>
        <button class="segment-btn" data-sub="sub-captured">Capturados</button>
      </div>

      <div id="sub-deposit" class="sub-view">
        <div class="card map-controls">
          <div class="controls-header">
            <div><h3>Gravar Trilha</h3><div class="stats-row"><span id="distanceText">0 m</span> â€¢ <span id="nestsCountText">0</span> iscas</div></div>
            <button id="btnStartRoute" class="btn-start">â–¶ Iniciar</button>
            <button id="btnFinishRoute" class="btn-stop hidden">â–  Parar</button>
          </div>
          <div id="routeHint" class="hint-box hidden"></div>
        </div>
        <div id="map-container">
          <div id="map"></div>
          <button id="btnMarkNest" class="fab-map" disabled>+ ğŸ</button>
        </div>
      </div>

      <div id="sub-trails" class="sub-view hidden">
        <h3>HistÃ³rico de Campo</h3>
        <p class="subtle">Reveja trilhas e faÃ§a manutenÃ§Ã£o nas iscas.</p>
        <div id="trailsList"></div>
        <div id="trailsEmpty" class="route-empty hidden">Nenhuma trilha gravada.</div>
      </div>

      <div id="sub-captured" class="sub-view hidden">
        <h3>Iscas Capturadas</h3>
        <p class="subtle">Monitore o prazo de 35 dias para transferÃªncia.</p>
        <div id="capturedList"></div>
        <div id="capturedEmpty" class="route-empty hidden">Nenhuma captura recente.</div>
      </div>
    </section>

    <section id="view-natural" class="view-section hidden">
      <div class="section-title"><h2>Ninhos na Mata</h2></div>
      <div class="card">
        <p>Registro de ocorrÃªncias naturais (sem isca).</p>
        <button class="btn-secondary full-width" onclick="alert('Use a aba Depositar para iscas ou implemente o registro avulso aqui.')">ğŸ“· Registrar Foto</button>
      </div>
      <div id="allNestsList"></div>
    </section>

    <section id="view-profile" class="view-section hidden">
      <div class="card profile-card">
        <div class="avatar-circle">ğŸ‘¤</div>
        <h3 id="p_email">...</h3>
        <button id="btnLogout" class="btn-outline btn-sm">Sair</button>
      </div>
    </section>

    <nav class="bottom-nav">
      <button class="nav-item active" data-target="view-meliponaries"><span>Caixas</span></button>
      <button class="nav-item" data-target="view-traps"><span>Iscas</span></button>
      <button class="nav-item" data-target="view-natural"><span>Mata</span></button>
      <button class="nav-item" data-target="view-profile"><span>Perfil</span></button>
    </nav>
  </div>

  <div id="nest-modal" class="modal-backdrop">
    <div class="modal-card">
      <h4>Dados da Isca/Ninho</h4>
      <div class="modal-field"><label>EspÃ©cie</label><input id="nestSpecies" type="text" placeholder="Ex: JataÃ­" /></div>
      <div class="modal-field">
        <label>Status</label>
        <select id="nestStatus">
          <option value="DEPOSITADO">Depositado (PadrÃ£o)</option>
          <option value="SUBSTITUIDO">SubstituÃ­do (ManutenÃ§Ã£o)</option>
          <option value="CAPTURADO">Capturado (Sucesso)</option>
          <option value="EXCLUIR">Excluir (Remover)</option>
        </select>
      </div>
      <div class="modal-field"><label>ObservaÃ§Ã£o</label><textarea id="nestNote"></textarea></div>
      <div class="modal-field"><label class="modal-file-label">ğŸ“· Foto <input id="nestPhoto" type="file" accept="image/*" capture="environment" /></label></div>
      <div class="modal-actions">
        <button id="nestCancel" class="btn-sm">Cancelar</button>
        <button id="btnConfirmNest" class="btn-sm btn-sm-primary">Salvar</button>
      </div>
    </div>
  </div>

  <script type="module" src="./js/main.js"></script>
</body>
</html>