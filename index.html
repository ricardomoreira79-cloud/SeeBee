<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>SeeBee App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <link rel="stylesheet" href="./css/main.css">
</head>
<body>

  <div id="auth-screen">
    <div class="brand-hero"><div class="brand-logo">ğŸ</div><div class="brand-name">SeeBee</div></div>
    <div id="auth-card">
      <h2>Entrar</h2>
      <div class="auth-field"><label>E-mail</label><input id="email" type="email"></div>
      <div class="auth-field"><label>Senha</label><input id="password" type="password"></div>
      
      <button id="btnLogin" class="btn-primary">Entrar</button>
      <button id="btnSignup" class="btn-outline">Criar Conta</button>
      <button id="btnGoogle" class="btn-google">Entrar com Google</button>
      
      <div id="authMsg" style="margin-top:10px; color:#ef4444; font-size:13px; text-align:center;"></div>
    </div>
  </div>

  <div id="app-screen" class="hidden">
    
    <div id="side-menu" class="side-drawer">
      <div class="drawer-header">
        <div class="profile-mini">
          <div class="avatar-circle" id="menu-avatar-char">A</div>
          <img id="menu-avatar-img" src="" class="hidden" style="width:45px; height:45px; border-radius:50%; object-fit:cover; border:2px solid var(--primary);">
          <div style="margin-left:10px;">
             <span id="menu-name-display" style="font-weight:bold;">UsuÃ¡rio</span>
             <span id="menu-role-display" style="font-size:12px; display:block; color:#10b981;">CARREGANDO...</span>
          </div>
        </div>
        <button id="close-menu">âœ•</button>
      </div>
      <nav class="drawer-nav">
        <button class="menu-item" onclick="app.nav('view-home')">ğŸ  InÃ­cio</button>
        <button class="menu-item" onclick="app.nav('view-traps')">ğŸ—ºï¸ Instalar Ninhos</button>
        <button class="menu-item" onclick="app.nav('view-meliponaries')">ğŸ“¦ Minhas ColÃ´nias</button>
        <button class="menu-item" onclick="app.nav('view-captures')">ğŸ Capturas</button>
        <button class="menu-item" onclick="app.nav('view-profile')">ğŸ‘¤ Perfil</button>
        <hr><button id="btnLogout" class="menu-item danger">Sair</button>
      </nav>
    </div>

    <header class="app-header">
      <button id="open-menu" class="btn-icon">â˜°</button>
      <div class="brand-mini">SeeBee</div>
      <div style="width:24px;"></div>
    </header>

    <main class="content-area">
      <section id="view-home" class="view-section active">
        <h2 style="margin-bottom:20px;">Painel</h2>
        <div class="dashboard-grid">
          <div class="dash-card" onclick="app.nav('view-traps')">
            <div class="dash-icon">ğŸ—ºï¸</div><h3>Nova InstalaÃ§Ã£o</h3>
          </div>
          <div class="dash-card" onclick="app.nav('view-meliponaries')">
            <div class="dash-icon">ğŸ“¦</div><h3>ColÃ´nias</h3>
          </div>
          <div class="dash-card" onclick="app.nav('view-captures')">
            <div class="dash-icon">ğŸ</div><h3>Capturas</h3>
          </div>
          <div class="dash-card" onclick="app.nav('view-profile')">
            <div class="dash-icon">ğŸ‘¤</div><h3>Perfil</h3>
          </div>
        </div>
        
        <div style="margin-top:30px;">
            <h3 style="font-size:16px; margin-bottom:10px; color:#94a3b8;">Ãšltimas InstalaÃ§Ãµes</h3>
            <div id="homeRecentTrails"></div>
        </div>
      </section>

      <section id="view-traps" class="view-section hidden">
        <div class="tracking-card">
          <div class="card-header"><h3>InstalaÃ§Ã£o</h3><span id="statusBadge" class="badge-status">Parado</span></div>
          <div class="action-buttons-row">
            <button id="btnStart" class="btn-action-start" onclick="app.startRecording()">â–¶ Iniciar</button>
            <button id="btnStop" class="btn-action-stop hidden" onclick="app.stopRecording()">â–  Parar</button>
            <button id="btnNest" class="btn-action-nest" onclick="app.openNestModal()" disabled>+ Ninho</button>
          </div>
          <div class="stats-row">
            <div class="stat-pill">Dist: <b id="distText">0 m</b></div>
            <div class="stat-pill">Ninhos: <b id="nestCountText">0</b></div>
            <div class="stat-pill" id="gpsStatus">GPS OFF</div>
          </div>
        </div>
        <div id="map"></div>
      </section>

      <section id="view-meliponaries" class="view-section hidden">
        <h3>Minhas ColÃ´nias</h3>
        <button class="btn-primary-sm" onclick="document.getElementById('colony-modal').style.display='flex'">+ Nova Matriz</button>
        <div id="coloniesList" style="margin-top:15px;"></div>
      </section>

      <section id="view-captures" class="view-section hidden">
        <h3>Capturas</h3>
        <div id="capturesList"></div>
      </section>

      <section id="view-profile" class="view-section hidden">
        <h3>Meu Perfil</h3>
        <div style="text-align:center; margin-bottom:20px;">
             <img id="profileImageDisplay" src="https://cdn-icons-png.flaticon.com/512/847/847969.png" style="width:100px; height:100px; border-radius:50%; object-fit:cover; border:2px solid var(--primary);">
             <br>
             <label class="btn-outline-photo" style="display:inline-block; padding:8px 15px; margin-top:10px; font-size:12px;">
                Alterar Foto <input id="profileAvatarInput" type="file" accept="image/*" style="display:none">
             </label>
        </div>
        <div class="card-profile-settings">
            <label class="field-label">Nome Completo</label>
            <input type="text" id="profName" class="input-dark">
            
            <label class="field-label">CPF</label>
            <input type="text" id="profCPF" class="input-dark">
            
            <label class="field-label">Telefone</label>
            <input type="text" id="profPhone" class="input-dark">
            
            <label class="field-label" style="color:var(--primary);">Cargo</label>
            <input type="text" id="profRole" class="input-dark" disabled style="opacity:0.7;">
            
            <button class="btn-primary" onclick="app.saveProfile()">Salvar Dados</button>
        </div>
      </section>
    </main>

    <div id="nest-modal" class="modal-backdrop" style="display:none">
      <div class="modal-card">
        <h3>Registrar Ninho</h3>
        <textarea id="nestNote" rows="3" placeholder="ObservaÃ§Ãµes..."></textarea>
        <label class="btn-outline-photo" id="lblPhoto" style="margin-top:10px;">
            ğŸ“· Foto <input id="nestPhoto" type="file" accept="image/*" style="display:none">
        </label>
        <div class="modal-actions" style="margin-top:20px;">
            <button class="btn-ghost" onclick="document.getElementById('nest-modal').style.display='none'">Cancelar</button>
            <button class="btn-solid" onclick="app.confirmNest()">Salvar</button>
        </div>
      </div>
    </div>

    <div id="colony-modal" class="modal-backdrop" style="display:none">
      <div class="modal-card">
        <h3>Nova Matriz</h3>
        <label class="field-label">Nome/ID</label><input type="text" id="colonyName" class="input-dark">
        <label class="field-label">EspÃ©cie</label><input type="text" id="colonySpecie" class="input-dark">
        <div class="modal-actions">
            <button class="btn-ghost" onclick="document.getElementById('colony-modal').style.display='none'">Cancelar</button>
            <button class="btn-solid" onclick="app.saveColony()">Salvar</button>
        </div>
      </div>
    </div>

    <div id="countdown-modal" class="modal-backdrop" style="display:none; z-index:9999; background:rgba(2,6,23,0.95);">
      <div style="text-align:center;">
        <div id="countdown-number" style="font-size:120px; font-weight:900; color:var(--primary); text-shadow:0 0 30px var(--primary);">3</div>
        <p style="color:white; font-size:18px; margin-top:20px;">Preparando GPS...</p>
      </div>
    </div>

    <div id="toast" class="hint-toast hidden"></div>
  </div>

  <script type="module" src="./js/app.js"></script>
</body>
</html>