<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>SeeBee â€“ Meliponicultura</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="theme-color" content="#020617" />
  
  <link rel="manifest" href="manifest.webmanifest" />
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  
  <link rel="stylesheet" href="./css/main.css" />
  
  <style>
    /* Estilos Extras EspecÃ­ficos (Segmented Control + Status) */
    .segmented-control {
      display: flex; background: #1e293b; padding: 4px; border-radius: 8px; margin-bottom: 16px;
    }
    .segment-btn {
      flex: 1; padding: 8px; border: none; background: transparent; color: #94a3b8;
      font-size: 0.85rem; border-radius: 6px; cursor: pointer; transition: all 0.2s;
    }
    .segment-btn.active { background: #0f172a; color: #fff; font-weight: 600; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
    
    .status-alert { color: #facc15; font-size: 0.8rem; margin-top: 4px; display: block; }
    .status-ok { color: #4ade80; font-size: 0.8rem; }
  </style>
</head>
<body>

  <div id="auth-screen">
    <div class="brand-hero">
      <div class="brand-logo">ğŸ</div>
      <div class="brand-name">SeeBee</div>
    </div>
    <div id="auth-card">
      <h2>Entrar</h2>
      <p>Gerencie seus meliponÃ¡rios e trilhas.</p>
      
      <div class="auth-field">
        <label>E-mail</label>
        <input id="email" type="email" placeholder="seu@email.com" />
      </div>
      <div class="auth-field">
        <label>Senha</label>
        <input id="password" type="password" placeholder="******" />
      </div>

      <div class="auth-buttons">
        <button id="btnLogin" class="btn-primary">Entrar</button>
        <button id="btnSignup" class="btn-outline">Criar Conta</button>
      </div>
      
      <button id="btnGoogle" class="btn-google">
        <span class="btn-google-icon"></span> Entrar com Google
      </button>
      
      <div id="authMsg" class="auth-msg"></div>
    </div>
  </div>

  <div id="app-screen" class="hidden">
    
    <header class="app-header">
      <div class="brand-mini">
        <div class="brand-mini-logo">ğŸ</div>
        <div class="brand-mini-name">SeeBee</div>
      </div>
      <div class="status-pill" id="onlinePill">
        <span id="onlineDot" class="status-dot"></span>
        <span id="onlineText">Online</span>
      </div>
    </header>

    <section id="view-meliponaries" class="view-section active">
      <div class="section-title">
        <h2>Meus MeliponÃ¡rios</h2>
        <button class="btn-xs">Novo</button>
      </div>
      
      <div id="colonies-list" class="list-vertical">
        <div class="card empty-state"><p>Carregando...</p></div>
      </div>
    </section>

    <section id="view-traps" class="view-section hidden">
      
      <div class="segmented-control">
        <button class="segment-btn active" data-sub="sub-deposit">Depositar</button>
        <button class="segment-btn" data-sub="sub-trails">Minhas Trilhas</button>
        <button class="segment-btn" data-sub="sub-captured">Capturados</button>
      </div>

      <div id="sub-deposit" class="sub-view">
        <div class="card map-controls">
          <div class="controls-header">
            <div>
              <h3>Rastreador</h3>
              <div class="stats-row">
                <span id="distanceText">0 m</span> â€¢ <span id="nestsCountText">0</span> iscas
              </div>
            </div>
            <button id="btnStartRoute" class="btn-start">â–¶ Iniciar</button>
            <button id="btnFinishRoute" class="btn-stop hidden">â–  Parar</button>
          </div>
          <div id="routeHint" class="hint-box hidden"></div>
        </div>

        <div id="map-container">
          <div id="map"></div>
          <button id="btnMarkNest" class="fab-map" disabled>+ ğŸ</button>
        </div>
      </div>

      <div id="sub-trails" class="sub-view hidden">
        <h3>HistÃ³rico de Campo</h3>
        <p class="subtle">Reveja seus trajetos gravados.</p>
        <div id="trailsList"></div>
        <div id="trailsEmpty" class="route-empty hidden">Nenhuma trilha gravada.</div>
      </div>

      <div id="sub-captured" class="sub-view hidden">
        <h3>Iscas Capturadas</h3>
        <p class="subtle">Acompanhe o prazo de maturaÃ§Ã£o (35 dias).</p>
        <div id="capturedList"></div>
        <div id="capturedEmpty" class="route-empty hidden">Nenhuma captura recente.</div>
      </div>
    </section>

    <section id="view-natural" class="view-section hidden">
      <div class="section-title">
        <h2>Ninhos na Mata</h2>
        <p class="subtle">Registro de ocorrÃªncias naturais</p>
      </div>
      
      <div class="card">
        <p>Encontrou um ninho na natureza sem isca?</p>
        <button class="btn-secondary full-width" onclick="alert('Use a aba Depositar para iscas ou implemente o registro avulso aqui.')">ğŸ“· Registrar Foto</button>
      </div>

      <div id="allNestsList" style="margin-top:15px"></div>
      <div id="nestsEmpty" class="route-empty hidden">Nenhum registro.</div>
    </section>

    <section id="view-profile" class="view-section hidden">
      
      <div class="profile-header-card">
        <div class="profile-avatar">
          <span id="p_initials">U</span>
        </div>
        <div class="profile-info">
          <h3 id="p_email_display">Carregando...</h3>
          <span class="badge-role" id="p_role">Meliponicultor</span>
          <div class="profile-id">ID: <span id="p_id_short">...</span></div>
        </div>
      </div>

      <div class="stats-grid">
        <div class="stat-box">
          <span class="stat-num" id="stat_meliponaries">0</span>
          <span class="stat-label">MeliponÃ¡rios</span>
        </div>
        <div class="stat-box">
          <span class="stat-num" id="stat_nests">0</span>
          <span class="stat-label">Iscas Totais</span>
        </div>
        <div class="stat-box">
          <span class="stat-num" id="stat_trails">0</span>
          <span class="stat-label">Trilhas</span>
        </div>
      </div>

      <div class="menu-list">
        <button class="menu-item" onclick="alert('Funcionalidade futura: Sincronizar dados offline')">
          <span>ğŸ”„ Sincronizar Dados</span>
        </button>
        <button class="menu-item" onclick="alert('Funcionalidade futura: Exportar relatÃ³rios')">
          <span>ğŸ“Š RelatÃ³rios</span>
        </button>
        <button class="menu-item danger" id="btnLogoutAction">
          <span>ğŸšª Sair da Conta</span>
        </button>
      </div>
      
      <div style="text-align:center; margin-top:20px; color:#4b5563; font-size:0.75rem;">
        SeeBee v1.2 â€¢ Cache v2
      </div>
    </section>

    <nav class="bottom-nav">
      <button class="nav-item active" data-target="view-meliponaries">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/><path d="M9 21V9"/></svg>
        <span>Caixas</span>
      </button>

      <button class="nav-item" data-target="view-traps">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
        <span>Iscas</span>
      </button>

      <button class="nav-item" data-target="view-natural">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.77 10.3-8 10z"/></svg>
        <span>Mata</span>
      </button>

      <button class="nav-item" data-target="view-profile">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
        <span>Perfil</span>
      </button>
    </nav>

  </div>

  <div id="photo-modal" class="hidden">
    <button id="photo-modal-close">Fechar</button>
    <img id="photo-modal-img" src="" />
  </div>
  
  <div id="nest-modal" class="modal-backdrop">
    <div class="modal-card">
      <h4>Dados da Isca/Ninho</h4>
      
      <div class="modal-field">
        <label>EspÃ©cie (Opcional)</label>
        <input id="nestSpecies" type="text" placeholder="Ex: JataÃ­" />
      </div>
      
      <div class="modal-field">
        <label>Status</label>
        <select id="nestStatus">
          <option value="DEPOSITADO">Depositado (PadrÃ£o)</option>
          <option value="SUBSTITUIDO">SubstituÃ­do (ManutenÃ§Ã£o)</option>
          <option value="CAPTURADO">Capturado (Sucesso)</option>
          <option value="EXCLUIR">Excluir (Remover)</option>
        </select>
      </div>
      
      <div class="modal-field">
        <label>ObservaÃ§Ã£o</label>
        <textarea id="nestNote"></textarea>
      </div>
      
      <div class="modal-field">
        <label class="modal-file-label">
          ğŸ“· Foto 
          <input id="nestPhoto" type="file" accept="image/*" capture="environment" />
        </label>
      </div>
      
      <div class="modal-actions">
        <button id="nestCancel" class="btn-sm">Cancelar</button>
        <button id="btnConfirmNest" class="btn-sm btn-sm-primary">Salvar</button>
      </div>
    </div>
  </div>

  <script type="module" src="./js/main.js"></script>
</body>
</html>